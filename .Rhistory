library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
сar_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
summarise(value = n()) %>%
View()
сar_registry
View(car_registry)
сar_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
summarise(value = n()) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer) %>%
summarise(freq = n()) %>%
arrange(desc(freq))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
summarise(value = n()) %>%
View()
df <- car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
summarise(value = n())
require(RJSONIO)
makeList<-function(x){
if(ncol(x)>2){
listSplit<-split(x[-1],x[1],drop=T)
lapply(names(listSplit),function(y){list(name=y,children=makeList(listSplit[[y]]))})
}else{
lapply(seq(nrow(x[1])),function(y){list(name=x[,1][y],Percentage=x[,2][y])})
}
}
require(RJSONIO)
install.packages("RJSONIO")
library(RJSONIO)
makeList<-function(x){
if(ncol(x)>2){
listSplit<-split(x[-1],x[1],drop=T)
lapply(names(listSplit),function(y){list(name=y,children=makeList(listSplit[[y]]))})
}else{
lapply(seq(nrow(x[1])),function(y){list(name=x[,1][y],Percentage=x[,2][y])})
}
}
jsonOut<-toJSON(list(name="treemap",children=makeList(df[-1])))
cat(jsonOut)
jsonOut<-toJSON(list(name="treemap",children=makeList(df[-1])))
jsonOut<-toJSON(list(name="treemap",children=makeList(df[1])))
jsonOut<-toJSON(list(name="treemap",children=makeList(df[2])))
jsonOut<-toJSON(list(name="treemap",children=makeList(df[2])))
makeList<-function(x){
if(ncol(x)>2){
listSplit<-split(x[-1],x[1],drop=T)
lapply(names(listSplit),function(y){
if(as.character(listSplit[[y]][1,1]) > 0){
list(name=y,children=makeList(listSplit[[y]]))
} else {
list(name=y,size=listSplit[[y]][1,2])
}
})
}else{
lapply(seq(nrow(x[1])),function(y){list(name=x[,1][y],size=x[,2][y])})
}
}
jsonOut<-toJSON(list(name="treemap",children=makeList(df[-1])))
df[-1]))
df[-1]))
cat(jsonOut)
jsonOut<-toJSON(list(name="MyData",children=makeList(MyData[-1])))
MyData <- car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
summarise(value = n())
jsonOut<-toJSON(list(name="MyData",children=makeList(MyData[-1])))
knitr::opts_chunk$set(echo = TRUE)
library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
#spread(brand) %>%
View()
#write.csv("data2.csv", row.names = FALSE)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
View()
#write.csv("data2.csv", row.names = FALSE)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
View()
#write.csv("data2.csv", row.names = FALSE)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .)))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
View()
#write.csv("data2.csv", row.names = FALSE)
setwd(Sys.glob("~/Code/Front End/car_register/line plot/"))
setwd(Sys.glob("~/Code/Front End/car_register/line plot/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
write.csv("data_wide(renault).csv", row.names = FALSE)
setwd(Sys.glob("~/Code/Front End/car_register/line plot/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
write.csv("data_wide.csv", row.names = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
library(date)
library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(treemapify)
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest()
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest()
library("jsonlite", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.4")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json()
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "~/Code/Front End/car_register/sun/")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(file = "car.json")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "~/Code/Front End/car_register/sun/", file = "car.json")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
x <- car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(x, file = "car.json")
x <- car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest()
write_json(x, file = "car.json")
?write_json
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "/home/ptr_bodnar/Code/Front End/car_register", file = "car.json")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "home/ptr_bodnar/Code/Front End/car_register", file = "car.json")
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(file = "car.json")
setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "~/Code/Front End/car_register/sun/", file = "car.json")
getwd()
#setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "/home/ptr_bodnar/Code/Front End/car_register/sun/", file = "car.json")
getwd()
#setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "/home/ptr_bodnar")
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest()
#setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest()
#setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "/home/ptr_bodnar/Code/Front End/car_register/sun/", file = "car.json")
?write_json
#setwd(Sys.glob("~/Code/Front End/car_register/sun/"))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
group_by(producer, brand) %>%
nest() %>%
write_json(path = "/home/ptr_bodnar/Code/Front End/car_register/sun/car.json")
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
#filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(producer, model) %>%
summarise(size = n()) %>%
arrange(desc(size)) %>%
ungroup()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
#filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(producer, model) %>%
summarise(size = n()) %>%
arrange(desc(size)) %>%
ungroup()
library(tidyverse)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
#filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(producer, model) %>%
summarise(size = n()) %>%
arrange(desc(size)) %>%
ungroup()
View(car_registry)
setwd("~/git/car_cloud")
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
write.csv("data_wide1.csv", row.names = FALSE)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .)))
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
View()
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(d_reg, brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
arrange(desc(freq)) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(value = sum(freq)) %>%
ungroup() %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
mutate(freq = n()) %>%
ungroup() %>%
arrange(desc(freq)) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(freq = n()) %>%
ungroup() %>%
arrange(desc(freq)) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(freq = n()) %>%
ungroup() %>%
spread(brand, value) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
View()
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(size = n()) %>%
ungroup() %>%
spread(brand, size) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
View()
write.csv("data_wide1.csv", row.names = FALSE)
car_registry %>%
filter(kind == "ЛЕГКОВИЙ") %>%
filter(oper_code %in% c(100, 172, 99, 30, 20)) %>%
#filter(producer == "RENAULT") %>%
group_by(date = format(d_reg, format="%Y-%m"), brand) %>%
summarise(size = n()) %>%
ungroup() %>%
spread(brand, size) %>%
mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
write.csv("data_wide1.csv", row.names = FALSE)
getwd()
